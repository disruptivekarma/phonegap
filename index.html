<!DOCTYPE html>
<html manifest="https://scrollback.io/manifest.appcache" lang="en">
    <head>
        <title>Scrollback</title>
        <style type="text/css">
            html, body {
                height: 100%;
                width: 100%;
                background-color: #3ca;
            }
        </style>
        <script src="phonegap.js"></script>
        <script src="index.js"></script>
        <script>
            document.addEventListener("deviceready", onDeviceReady, false);

            function onDeviceReady() {
                var req = new XMLHttpRequest(),
                    url = "https://scrollback.io/client.html",
                    scriptString = "<script>$.ready();app.initialize();<\/script>";

                req.onreadystatechange = function() {
                    var matches;

                    if (req.readyState === 4) {
                        if (req.status === 200) {
                            clientString = req.response;

                            if (clientString) {
                                clientString = clientString.replace("<!-- phonegap scripts -->", scriptString);

                                matches = /((?:\r|\n|.)+)(<body.*class=['"])(.*)(["'].*>)((?:\r|\n|.)+)/.exec(clientString);

                                matches.splice(0, 1);

                                matches[2] += " media-phonegap state-offline";

                                document.write(matches.join(""));
                            } else {
                                console.error("Response is empty for " + url + ".");
                            }
                        } else {
                            console.error("AJAX request failed for " + url + ".");
                        }
                    }
                };

                req.open("GET", url, true);
                req.send();
            }
        </script>
    </head>

    <body>
    </body>
</html>

